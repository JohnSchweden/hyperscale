---
phase: 03-polish-performance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - App.tsx
  - index.html
autonomous: true
must_haves:
  truths:
    - All 8 stage transitions use identical animation duration (400-500ms)
    - All 8 stage transitions use identical easing curve
    - No directional transitions exist (fade only, no slide)
    - Button hovers use Quick timing (150-200ms)
    - Stage transitions use Medium timing (300-500ms)
    - Celebration animations use Slow timing (500-800ms)
  artifacts:
    - path: index.html
      provides: Animation timing CSS variables for all three speeds
      contains: "--anim-quick, --anim-medium, --anim-slow"
    - path: App.tsx
      provides: All 8 stages wrapped with consistent stage-transition class
      exports: "renderIntro, renderPersonalitySelect, etc. all use same wrapper"
  key_links:
    - from: index.html
      to: App.tsx
      via: stage-transition class applied consistently
      pattern: "className=\"[^\"]*stage-transition[^\"]*\""
---

<objective>
Standardize all stage transition animations across the 8 game screens with consistent timing hierarchy.

Purpose: Users experience smooth, predictable transitions between screens without jarring or inconsistent motion. The fade-only approach prevents confusion with swipe gestures while the timing hierarchy creates visual rhythm.

Output: Updated index.html with animation timing variables, updated App.tsx with consistent transition wrappers on all 8 stage render methods.
</objective>

<execution_context>
@/Users/yevgenschweden/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/yevgenschweden/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/03-polish-performance/03-CONTEXT.md

Key locked decisions from CONTEXT.md:
- Fade only transitions (opacity 0â†’1) - NO directional animations
- Keep existing timing (0.5s = 500ms is acceptable)
- Animation timing hierarchy: Quick (150-200ms), Medium (300-500ms), Slow (500-800ms)

Current state:
- App.tsx line 960: Root div uses `stage-transition` class with `key={state.stage}`
- index.html lines 115-128: `stage-transition` class exists with fadeSlideIn animation
- Duration currently 0.5s which is at the upper end of Medium range
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add animation timing CSS variables</name>
  <files>index.html</files>
  <action>
Add CSS custom properties for animation timing hierarchy in the style block. Add after the body styles (around line 26):

```css
:root {
  /* Animation Timing Hierarchy */
  --anim-quick: 150ms;   /* Button hovers, micro-interactions */
  --anim-medium: 450ms;  /* Stage transitions, card swipes */
  --anim-slow: 600ms;    /* Emphasis animations, celebrations */
}
```

Update existing transition rules to use these variables:
1. Update `.stage-transition` animation duration from 0.5s to var(--anim-medium)
2. Update button transitions (line 210) from 0.3s to var(--anim-quick)
3. Update `.hover-scale` transitions (line 237) to use var(--anim-quick)
4. Update `.progress-bar` transition (line 216) to use var(--anim-medium)
5. Keep `.card-transition` and `.ticket-transition` at their current values or use var(--anim-medium)

Do NOT change the easing curve - keep cubic-bezier(0.25, 0.46, 0.45, 0.94)
  </action>
  <verify>
    grep -n "--anim-" index.html && echo "Variables defined" || echo "Variables NOT found"
  </verify>
  <done>
    CSS variables --anim-quick, --anim-medium, --anim-slow defined in :root, and existing transition rules reference them instead of hardcoded values
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify consistent stage-transition on all 8 stages</name>
  <files>App.tsx</files>
  <action>
The root wrapper at line 960 already has `stage-transition` class with `key={state.stage}` which triggers React re-mount on stage change, ensuring animations run.

Verify all 8 render methods return content that works correctly with this structure:
1. renderIntro (line 364) - returns flex-col div
2. renderPersonalitySelect (line 389) - returns flex-col div  
3. renderRoleSelect (line 439) - returns flex-col div
4. renderInitializing (line 491) - returns flex-col div
5. renderGame (line 523) - returns flex-col div
6. renderBossFight (line 753) - returns flex-col div
7. renderGameOver (line 845) - returns flex-col div
8. renderSummary (line 901) - returns flex-col div

Remove any conflicting animation classes from individual stage render methods that might override the stage-transition:
- Check for `.fade-in` usage (line 396, 443) - these are for content entry, keep them
- Check for `animate-pulse` (line 510, 853, 904) - these are intentional emphasis animations, keep them
- Check for `animate-bounce` (line 904) - intentional celebration, keep it

The key check: Ensure no stage has its own slide/sliding animation that would conflict with the fade-only requirement.
  </action>
  <verify>
    echo "Checking for conflicting directional transitions..."
    grep -n "slide\|Slide\|translateX\|translateY" App.tsx | grep -v "// " | grep -v "comment" | head -20
    echo "Verifying stage-transition wrapper..."
    grep -n "stage-transition" App.tsx
  </verify>
  <done>
    Root stage-transition wrapper confirmed with key={state.stage}, no directional stage animations found in individual render methods, existing emphasis animations (pulse, bounce) remain
  </done>
</task>

<task type="auto">
  <name>Task 3: Add timing documentation comment</name>
  <files>index.html</files>
  <action>
Add a comment block before the animation CSS to document the timing hierarchy. Add after line 114 (before .stage-transition definition):

```css
/* Animation Timing Hierarchy
   Quick (150ms): Button hovers, micro-interactions, feedback
   Medium (450ms): Stage transitions, card swipes, progress bars  
   Slow (600ms): Emphasis animations, celebrations, modal overlays
   
   Easing: cubic-bezier(0.25, 0.46, 0.45, 0.94) - smooth ease-out
   Stage transitions use fade only (no directional movement)
   to avoid confusion with swipe gestures.
*/
```
  </action>
  <verify>
    grep -A 5 "Animation Timing Hierarchy" index.html | head -10
  </verify>
  <done>
    Documentation comment added explaining the timing hierarchy and rationale for fade-only stage transitions
  </done>
</task>

</tasks>

<verification>
1. All CSS timing uses variables instead of hardcoded values
2. :root defines --anim-quick, --anim-medium, --anim-slow
3. Stage transitions use var(--anim-medium) for 450ms duration
4. No directional stage transitions exist (grep for "translate" should only show swipe-related code)
5. Documentation explains the timing hierarchy
</verification>

<success_criteria>
- Animation timing hierarchy implemented with CSS variables
- All 8 stage transitions use consistent fade-only animation
- Duration falls within Medium range (300-500ms) at 450ms
- Documentation explains design rationale
</success_criteria>

<output>
After completion, create `.planning/phases/03-polish-performance/03-01-SUMMARY.md`
</output>
